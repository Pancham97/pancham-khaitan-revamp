<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pancham Khaitan OG image generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&family=Geist:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
      body { margin: 0; }
      .image {
        padding: 20px;
        color: white;
        font-size: 90px;
        width: 1280px;
        height: 720px;
        font-family: sans-serif;
        background-color: #0A192F; /* Deep navy monochrome */
        position: relative;
      }
      .site {
        position: absolute;
        top: 60px;
        left: 60px;
        margin: 0;
        font-size: 36px;
        font-weight: bold;
        font-family: "Geist Mono", monospace;
      }
      .text {
        max-width: 75%;
        text-align: left;
        margin: 0;
        bottom: 60px;
        left: 60px;
        position: absolute;
        font-family: "Geist", sans-serif;
      }
      .btn { margin: 16px; font-size: 16px; padding: 8px 14px; }
    </style>
  </head>
  <body>
    <button id="downloadBtn" class="btn" disabled>Download</button>

    <form id="my-form">
      <input type="text" name="title" id="title-input" placeholder="How to win friends">
      <input type="text" name="slug" id="slug-input" placeholder="my-slug">
      <button type="submit">Change title</button>
    </form>

    <div class="image" id="image">
      <p class="site">Pancham Khaitan</p>
      <h4 class="text">
        How to dynamically generate OG image
      </h4>
    </div>

    <script>
      let slug = "my-image";
      document.querySelector("#my-form").addEventListener("submit", function handleSubmit(e) {
        e.preventDefault();
        const titleVal = document.querySelector("#title-input").value;
        const slugVal = document.querySelector("#slug-input").value;
        slug = slugVal;
        document.querySelector(".text").innerText = titleVal;
      })

      // Ensure fonts are ready so the capture uses Geist
      document.fonts.ready.then(() => {
        // Enable button once fonts are loaded; we render on click
        document.getElementById('downloadBtn').disabled = false;
      });

      document.getElementById('downloadBtn').onclick = async () => {
        const target = document.getElementById('image');

        // Higher-DPI for crisp OGs
        // const scale = Math.max(2, window.devicePixelRatio || 1);
        const scale = 1;

        const canvas = await html2canvas(target, {
          scale,
          backgroundColor: null, // preserve gradient
          useCORS: true
        });

        // Prefer Blob -> object URL (less memory than big data URL strings)
        canvas.toBlob((blob) => {
          if (!blob) return;
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${slug}.jpeg`; // matches PNG content
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        }, 'image/jpeg');
      };
    </script>
  </body>
</html>
